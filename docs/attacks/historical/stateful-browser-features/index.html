<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Some browser features/extensions change the way requests are processed depending on certain website states generated by the browser. Attackers can sometimes observe the whole process and mess with the browser, triggering actions that produce side-effects on those states.
WebKit - ITP #  Intelligent Tracking Prevention (ITP) is a privacy feature part of WebKit Tracking Prevention technologies. It’s a conjunction of several features to prevent a website from tracking a user under a third-party context."><meta name=theme-color content="#FFFFFF"><meta property="og:title" content="Stateful Browser Features"><meta property="og:description" content="Some browser features/extensions change the way requests are processed depending on certain website states generated by the browser. Attackers can sometimes observe the whole process and mess with the browser, triggering actions that produce side-effects on those states.
WebKit - ITP #  Intelligent Tracking Prevention (ITP) is a privacy feature part of WebKit Tracking Prevention technologies. It’s a conjunction of several features to prevent a website from tracking a user under a third-party context."><meta property="og:type" content="article"><meta property="og:url" content="https://xsleaks.dev/docs/attacks/historical/stateful-browser-features/"><meta property="article:published_time" content="2020-10-01T00:00:00+00:00"><meta property="article:modified_time" content="2020-11-02T15:49:29-08:00"><title>Stateful Browser Features | XS-Leaks Wiki</title><link rel=manifest href=/manifest.json><link rel=icon href=/favicon.png type=image/x-icon><link rel=stylesheet href=/book.min.62d4a8cadd84fac6902eda1a0d09fc02098feb2b5faa4fd18c9862eb3c0b03a4.css integrity="sha256-YtSoyt2E+saQLtoaDQn8AgmP6ytfqk/RjJhi6zwLA6Q="><script defer src=/en.search.min.039a1aab4f88cbd565a5a79977f61566748f7efca6813eb9052216653d3404dd.js integrity="sha256-A5oaq0+Iy9VlpaeZd/YVZnSPfvymgT65BSIWZT00BN0="></script><script defer src=/sw.min.74a8bb07f0bee86d6bb9a2750f073f14d93c7e4512f28860370cfd879e9719b4.js integrity="sha256-dKi7B/C+6G1ruaJ1Dwc/FNk8fkUS8ohgNwz9h56XGbQ="></script></head><body><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><nav><h2 class=book-brand><a href=/><span>XS-Leaks Wiki</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li class=book-section-flat><span>Attacks</span><ul><li><a href=/docs/attacks/xs-search/>XS-Search</a></li><li><a href=/docs/attacks/error-events/>Error Events</a></li><li><a href=/docs/attacks/frame-counting/>Frame Counting</a></li><li><a href=/docs/attacks/navigations/>Navigations</a></li><li><a href=/docs/attacks/cache-probing/>Cache Probing</a></li><li><a href=/docs/attacks/id-attribute/>ID Attribute</a></li><li><a href=/docs/attacks/postmessage-broadcasts/>postMessage Broadcasts</a></li><li><span>Browser Features</span><ul><li><a href=/docs/attacks/browser-features/corb/>CORB Leaks</a></li><li><a href=/docs/attacks/browser-features/corp/>CORP Leaks</a></li></ul></li><li><span>Timing Attacks</span><ul><li><a href=/docs/attacks/timing-attacks/clocks/>Clocks</a></li><li><a href=/docs/attacks/timing-attacks/network-timing/>Network Timing</a></li><li><a href=/docs/attacks/timing-attacks/execution-timing/>Execution Timing</a></li><li><a href=/docs/attacks/timing-attacks/hybrid-timing/>Hybrid Timing</a></li><li><a href=/docs/attacks/timing-attacks/connection-pool/>Connection Pool</a></li></ul></li><li><a href=/docs/attacks/experiments/ class=collapsed>Experiments</a></li><li><a href=/docs/attacks/historical/ class=collapsed>Historical</a><ul><li><a href=/docs/attacks/historical/content-type/>Content-Type</a></li><li><a href=/docs/attacks/historical/stateful-browser-features/ class=active>Stateful Browser Features</a></li></ul></li></ul></li><li class=book-section-flat><a href=/docs/defenses/>Defense Mechanisms</a><ul><li><a href=/docs/defenses/design-protections/>Application Design</a><ul><li><a href=/docs/defenses/design-protections/cache-protections/>Cache Protections</a></li><li><a href=/docs/defenses/design-protections/subresource-protections/>Subresource Protections</a></li></ul></li><li><a href=/docs/defenses/opt-in/>Opt-In Mechanisms</a><ul><li><a href=/docs/defenses/opt-in/coop/>Cross-Origin-Opener-Policy</a></li><li><a href=/docs/defenses/opt-in/corp/>Cross-Origin-Resource-Policy</a></li><li><a href=/docs/defenses/opt-in/fetch-metadata/>Fetch Metadata</a></li><li><a href=/docs/defenses/opt-in/xfo/>Framing Protections</a></li><li><a href=/docs/defenses/opt-in/same-site-cookies/>SameSite Cookies</a></li></ul></li><li><a href=/docs/defenses/secure-defaults/>Secure Defaults</a><ul><li><a href=/docs/defenses/secure-defaults/corb/>Cross-Origin Read Blocking</a></li><li><a href=/docs/defenses/secure-defaults/partitioned-cache/>Partitioned HTTP Cache</a></li></ul></li></ul></li></ul></nav><script>(function(){var menu=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(event){localStorage.setItem("menu.scrollTop",menu.scrollTop);});menu.scrollTop=localStorage.getItem("menu.scrollTop");})();</script></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label>
<strong>Stateful Browser Features</strong>
<label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#webkit---itp>WebKit - ITP</a><ul><li><a href=#root-cause>Root Cause</a></li><li><a href=#fix>Fix</a></li></ul></li><li><a href=#references>References</a></li></ul></nav></aside></header><article class=markdown><h1>Stateful Browser Features</h1><h5>October 1, 2020</h5><div>Category
<a href=/category/historical/>Historical</a></div><div>Defenses
<a href=/defenses/browser-fix/>Browser Fix</a></div><p><p>Some browser features/extensions change the way requests are processed depending on certain website states generated by the browser. Attackers can sometimes observe the whole process and mess with the browser, triggering actions that produce side-effects on those states.</p><h2 id=webkit---itp>WebKit - ITP
<a class=anchor href=#webkit---itp>#</a></h2><p><a href=https://webkit.org/tracking-prevention/>Intelligent Tracking Prevention</a> (ITP) is a privacy feature part of <a href=https://webkit.org/tracking-prevention/>WebKit Tracking Prevention technologies</a>. It’s a conjunction of several features to prevent a website from tracking a user under a third-party context. Unfortunately, the initial design introduced a new XS-Leak <sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>, allowing attackers to abuse the states implicitly created by ITP to classify websites as trackers.</p><h3 id=root-cause>Root Cause
<a class=anchor href=#root-cause>#</a></h3><p>To classify whether a website has tracking capabilities, ITP collects statistics on resource loads as well as user interactions in websites such as clicks, taps, or text entries. Based on the classification of these statistics, ITP gives a strike to a website if it is believed to have tracking capabilities. After 3 strikes a website is put on a deny list and is treated differently by the browser in future requests.</p><h4 id=issues>Issues
<a class=anchor href=#issues>#</a></h4><p>One of the issues of ITP is that attackers can manipulate it to arbitrarily enforce certain behaviors. For example, one could force ITP to give a strike to a domain and check if the domain entered the deny list. This could be levered in different ways, for example:</p><ul><li>Leaking the user&rsquo;s browsing habits based off of how many strikes are necessary for a domain to enter the deny list</li><li>Using the deny list to implement an XS-Search attack against a page that includes cross-site resources only when results are present</li></ul><h3 id=fix>Fix
<a class=anchor href=#fix>#</a></h3><p>To <a href=https://webkit.org/blog/9661/preventing-tracking-prevention-tracking/>fix the issue</a>, instead of relying on classifications, ITP now considers every site as a &ldquo;tracking&rdquo; one by default. This removes the implicit states which allowed attackers to detect certain ITP behaviors.</p><h2 id=references>References
<a class=anchor href=#references>#</a></h2><section class=footnotes role=doc-endnotes><hr><ol><li id=fn:1 role=doc-endnote><p>Information Leaks via Safari’s Intelligent Tracking Prevention, <a href=https://arxiv.org/pdf/2001.07421.pdf>link</a> <a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></section></p></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/xsleaks/wiki/commit/8d1ad5db683de12593555b263a232467d204001f title="Last modified by David Dworken | November 2, 2020" target=_blank rel=noopener><img src=/svg/calendar.svg class=book-icon alt=Calendar>
<span>Last Modified: November 2, 2020</span></a></div><div><a class="flex align-center" href=https://github.com/xsleaks/wiki/edit/master/content//docs/attacks/historical/stateful-browser-features.md target=_blank rel=noopener><img src=/svg/edit.svg class=book-icon alt=Edit>
<span>Edit this article</span></a></div></div></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><nav id=TableOfContents><ul><li><a href=#webkit---itp>WebKit - ITP</a><ul><li><a href=#root-cause>Root Cause</a></li><li><a href=#fix>Fix</a></li></ul></li><li><a href=#references>References</a></li></ul></nav></aside></main></body></html>