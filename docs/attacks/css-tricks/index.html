<!doctype html><html lang=en dir=ZgotmplZ><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="
  CSS Tricks
  #

CSS can be used to trick a user into exposing information such as embedded pixel values by making visual changes that are affected by the embed.

  Retrieving user&rsquo;s history
  #

Using the CSS :visited selector, it’s possible to apply a different style for URLs that have been visited.
Previously it was possible to use getComputedStyle() to detect this difference, but now browsers prevent this by always returning values as if the link was visited and limiting what styles can be applied using the selector. 1
So, it may be needed to trick the user into clicking an area that the CSS has affected.
This can be done using mix-blend-mode. 2
There are also ways to do it without user interaction such as by abusing render timings.
This works because it takes time to paint links in a different color. 3
A Proof of Concept to this attack can be found in a Chromium report 4 and it works by having multiple links to increase the time difference."><meta name=theme-color content="#FFFFFF"><meta property="og:url" content="https://xsleaks.dev/docs/attacks/css-tricks/"><meta property="og:site_name" content="XS-Leaks Wiki"><meta property="og:title" content="CSS Tricks"><meta property="og:description" content="CSS Tricks # CSS can be used to trick a user into exposing information such as embedded pixel values by making visual changes that are affected by the embed.
Retrieving user’s history # Using the CSS :visited selector, it’s possible to apply a different style for URLs that have been visited.
Previously it was possible to use getComputedStyle() to detect this difference, but now browsers prevent this by always returning values as if the link was visited and limiting what styles can be applied using the selector. 1
So, it may be needed to trick the user into clicking an area that the CSS has affected. This can be done using mix-blend-mode. 2
There are also ways to do it without user interaction such as by abusing render timings. This works because it takes time to paint links in a different color. 3
A Proof of Concept to this attack can be found in a Chromium report 4 and it works by having multiple links to increase the time difference."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="docs"><meta property="article:published_time" content="2020-10-01T00:00:00+00:00"><meta property="article:modified_time" content="2024-07-03T08:11:07+02:00"><title>CSS Tricks | XS-Leaks Wiki</title>
<link rel=manifest href=/manifest.json><link rel=icon href=/favicon.png type=image/x-icon><link rel=stylesheet href=/book.min.1c9a9009be3c645cbccbe64eb0a90e28621e4118971d9a502db4aaa9bec96cfc.css integrity="sha256-HJqQCb48ZFy8y+ZOsKkOKGIeQRiXHZpQLbSqqb7JbPw="><script defer src=/en.search.min.4b0a0e5c472b82ce2e0b8fb53b12f2357a995b4df3e5361e577dddec4f0aa8b4.js integrity="sha256-SwoOXEcrgs4uC4+1OxLyNXqZW03z5TYeV33d7E8KqLQ="></script><script defer src=/sw.min.6f6f90fcb8eb1c49ec389838e6b801d0de19430b8e516902f8d75c3c8bd98739.js integrity="sha256-b2+Q/LjrHEnsOJg45rgB0N4ZQwuOUWkC+NdcPIvZhzk="></script></head><body dir=ZgotmplZ><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><nav><h2 class=book-brand><a href=/><span>XS-Leaks Wiki</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li class=book-section-flat><span>Attacks</span><ul><li><a href=/docs/attacks/xs-search/>XS-Search</a></li><li><a href=/docs/attacks/window-references/>Window References</a></li><li><a href=/docs/attacks/css-tricks/ class=active>CSS Tricks</a></li><li><a href=/docs/attacks/error-events/>Error Events</a></li><li><a href=/docs/attacks/frame-counting/>Frame Counting</a></li><li><a href=/docs/attacks/navigations/>Navigations</a></li><li><a href=/docs/attacks/cache-probing/>Cache Probing</a></li><li><a href=/docs/attacks/element-leaks/>Element leaks</a></li><li><a href=/docs/attacks/id-attribute/>ID Attribute</a></li><li><a href=/docs/attacks/postmessage-broadcasts/>postMessage Broadcasts</a></li><li><span>Browser Features</span><ul><li><a href=/docs/attacks/browser-features/corb/>CORB Leaks</a></li><li><a href=/docs/attacks/browser-features/corp/>CORP Leaks</a></li></ul></li><li><span>Timing Attacks</span><ul><li><a href=/docs/attacks/timing-attacks/clocks/>Clocks</a></li><li><a href=/docs/attacks/timing-attacks/network-timing/>Network Timing</a></li><li><a href=/docs/attacks/timing-attacks/performance-api/>Performance API</a></li><li><a href=/docs/attacks/timing-attacks/execution-timing/>Execution Timing</a></li><li><a href=/docs/attacks/timing-attacks/hybrid-timing/>Hybrid Timing</a></li><li><a href=/docs/attacks/timing-attacks/connection-pool/>Connection Pool</a></li></ul></li><li><a href=/docs/attacks/experiments/ class=collapsed>Experiments</a></li><li><a href=/docs/attacks/css-injection/>CSS Injection</a></li><li><a href=/docs/attacks/historical/ class=collapsed>Historical</a></li></ul></li><li class=book-section-flat><a href=/docs/defenses/>Defense Mechanisms</a><ul><li><a href=/docs/defenses/design-protections/>Application Design</a><ul><li><a href=/docs/defenses/design-protections/cache-protections/>Cache Protections</a></li><li><a href=/docs/defenses/design-protections/subresource-protections/>Subresource Protections</a></li></ul></li><li><a href=/docs/defenses/opt-in/>Opt-In Mechanisms</a><ul><li><a href=/docs/defenses/opt-in/fetch-metadata/>Fetch Metadata</a></li><li><a href=/docs/defenses/opt-in/coop/>Cross-Origin-Opener-Policy</a></li><li><a href=/docs/defenses/opt-in/corp/>Cross-Origin-Resource-Policy</a></li><li><a href=/docs/defenses/opt-in/xfo/>Framing Protections</a></li><li><a href=/docs/defenses/opt-in/same-site-cookies/>SameSite Cookies</a></li><li><a href=/docs/defenses/opt-in/document-policies/>Document Policies</a></li></ul></li><li><a href=/docs/defenses/isolation-policies/>Isolation Policies</a><ul><li><a href=/docs/defenses/isolation-policies/resource-isolation/>Resource Isolation Policy</a></li><li><a href=/docs/defenses/isolation-policies/framing-isolation/>Framing Isolation Policy</a></li><li><a href=/docs/defenses/isolation-policies/navigation-isolation/>Navigation Isolation Policy</a></li><li><a href=/docs/defenses/isolation-policies/strict-isolation/>Strict Isolation Policy</a></li></ul></li><li><a href=/docs/defenses/secure-defaults/>Secure Defaults</a><ul><li><a href=/docs/defenses/secure-defaults/corb/>Cross-Origin Read Blocking</a></li><li><a href=/docs/defenses/secure-defaults/partitioned-cache/>Partitioned HTTP Cache</a></li></ul></li></ul></li><li class=book-section-flat><a href=/docs/contributions/>Contributions</a><ul></ul></li></ul></nav><script>(function(){var e=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu>
</label><strong>CSS Tricks</strong>
<label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#css-tricks>CSS Tricks</a></li><li><a href=#retrieving-users-history>Retrieving user&rsquo;s history</a></li><li><a href=#leaking-status-code>Leaking status code</a></li><li><a href=#evil-captcha>Evil Captcha</a></li><li><a href=#abusing-autocomplete>Abusing autocomplete</a></li><li><a href=#custom-cursor>Custom cursor</a></li><li><a href=#defense>Defense</a></li><li><a href=#references>References</a></li></ul></nav></aside></header><article class=markdown><h1>CSS Tricks</h1><h5>October 1, 2020</h5><p><h2 id=css-tricks>CSS Tricks
<a class=anchor href=#css-tricks>#</a></h2><p>CSS can be used to trick a user into exposing information such as embedded pixel values by making visual changes that are affected by the embed.</p><h2 id=retrieving-users-history>Retrieving user&rsquo;s history
<a class=anchor href=#retrieving-users-history>#</a></h2><p>Using the CSS <a href=https://developer.mozilla.org/en-US/docs/Web/CSS/:visited><code>:visited</code></a> selector, it’s possible to apply a different style for URLs that have been visited.<br>Previously it was possible to use <a href=https://developer.mozilla.org/en-US/docs/Web/API/Window/getComputedStyle><code>getComputedStyle()</code></a> to detect this difference, but now browsers prevent this by always returning values as if the link was visited and limiting what styles can be applied using the selector. <sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup><br>So, it may be needed to trick the user into clicking an area that the CSS has affected.
This can be done using <a href=https://developer.mozilla.org/en-US/docs/Web/CSS/mix-blend-mode><code>mix-blend-mode</code></a>. <sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup><br>There are also ways to do it without user interaction such as by abusing render timings.
This works because it takes time to paint links in a different color. <sup id=fnref:3><a href=#fn:3 class=footnote-ref role=doc-noteref>3</a></sup><br>A Proof of Concept to this attack can be found in a Chromium report <sup id=fnref:4><a href=#fn:4 class=footnote-ref role=doc-noteref>4</a></sup> and it works by having multiple links to increase the time difference.</p><blockquote class="book-hint2 info"><p class="hint-title info"><svg class="book-icon"><use href="/svg/hint-icons.svg#info-notice"/></svg><span>info</span></p><p>This issue has been known for years and there are multiple open bugs to be fixed in multiple browsers <sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup> <sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup> <sup id=fnref:3><a href=#fn:3 class=footnote-ref role=doc-noteref>3</a></sup>. There are also publicily available proof of concepts, e.g. Whack a mole game <sup id=fnref:4><a href=#fn:4 class=footnote-ref role=doc-noteref>4</a></sup> that requires user interaction for a successful leak.</p><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>Issue 712246: Security: CSS :visited with mix-blend-mode can leak browser history, <a href=https://crbug.com/712246>link</a>&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2><p>Issue 713521: Eliminate :visited privacy issues once and for all, <a href=https://crbug.com/713521>link</a>&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:3><p>:visited support allows queries into global history, <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=147777">link</a>&#160;<a href=#fnref:3 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:4><p>Whack a mole game, <a href=https://lcamtuf.coredump.cx/whack/>link</a>&#160;<a href=#fnref:4 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></blockquote><h2 id=leaking-status-code>Leaking status code
<a class=anchor href=#leaking-status-code>#</a></h2><p>Tricks to reveal a user&rsquo;s history provide a way to detect the status code of a response cross-site. Chromium-based browsers will only save responses with OK status codes (e.g. 200) to the user&rsquo;s history, but won&rsquo;t add error status codes (e.g. 404). By visiting the target URL in a popup window, it will then either be saved to the history or not depending on the status code. After then placing the same URL on your page with <code>&lt;a href="..."></code>, it is possible to use one of the manual or automatic techniques described above to leak whether this URL was saved to the history or not.</p><p>In some XS-Search scenarios, a search with no results will return a 404 error. Cookies marked <code>SameSite=Lax</code> will be sent in popup windows, and this technique allows such scenarios to be exploited. <sup id=fnref:5><a href=#fn:5 class=footnote-ref role=doc-noteref>5</a></sup></p><h2 id=evil-captcha>Evil Captcha
<a class=anchor href=#evil-captcha>#</a></h2><p>Using CSS, it’s possible to take an embed out of context.<br>An example of this is pretending it’s a captcha as seen in <sup id=fnref:6><a href=#fn:6 class=footnote-ref role=doc-noteref>6</a></sup><br>This works by setting the width and height of an embed so that only the target characters are shown,
this may use multiple embeds to change the order of the characters being displayed so that its harder for a user to know what information they&rsquo;re providing.</p><h2 id=abusing-autocomplete>Abusing autocomplete
<a class=anchor href=#abusing-autocomplete>#</a></h2><p>If a website uses text inputs and does not opt-out of <a href=https://developer.mozilla.org/en-US/docs/Web/HTML/Attributes/autocomplete>autocomplete</a> using <code>autocomplete="off"</code> it may be possible to leak data such as email addresses by tricking the user into pressing the keys to navigate the autocomplete UI for a javascript focused text input.
For Chrome, this requires the user to be tricked into pressing the Up or Down arrow key which opens the dialog and selects a value, then by pressing Enter or Tab the value gets inserted into the page.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>let</span> input <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>document</span>.createElement(<span style=color:#f1fa8c>&#34;input&#34;</span>);
</span></span><span style=display:flex><span>input.type <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;email&#34;</span>;
</span></span><span style=display:flex><span>input.autocomplete <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;email&#34;</span>;
</span></span><span style=display:flex><span>input.name <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;email&#34;</span>;
</span></span><span style=display:flex><span>input.size <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;1&#34;</span>;
</span></span><span style=display:flex><span>input.style <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;position:absolute;right:-500px;bottom:-21.9px&#34;</span>;
</span></span><span style=display:flex><span>input.onkeypress <span style=color:#ff79c6>=</span> e =&gt; {
</span></span><span style=display:flex><span>    e.preventDefault();
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>window</span>.onmousedown <span style=color:#ff79c6>=</span> e =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#6272a4>// ignore mouse clicks
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    e.preventDefault();
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>input.onchange <span style=color:#ff79c6>=</span> e =&gt; {
</span></span><span style=display:flex><span>    alert(e.srcElement.value);
</span></span><span style=display:flex><span>    e.srcElement.value <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;&#34;</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>document</span>.body.appendChild(input);
</span></span><span style=display:flex><span>setInterval(() =&gt; {
</span></span><span style=display:flex><span>    input.focus({preventScroll<span style=color:#ff79c6>:</span> <span style=color:#ff79c6>true</span>});
</span></span><span style=display:flex><span>}, <span style=color:#bd93f9>1000</span>);
</span></span></code></pre></div><h2 id=custom-cursor>Custom cursor
<a class=anchor href=#custom-cursor>#</a></h2><p>A custom cursor might not leak data directly but it may help trick the user, as a large cursor may overlay the autocomplete dialog and other native UI.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>&lt;<span style=color:#ff79c6>style</span>&gt;
</span></span><span style=display:flex><span>:root {
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>cursor</span>: <span style=color:#8be9fd;font-style:italic>url</span>(<span style=color:#f1fa8c>&#39;https://www.google.com/favicon.ico&#39;</span>), <span style=color:#ff79c6>auto</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>&lt;/<span style=color:#ff79c6>style</span>&gt;
</span></span></code></pre></div><h2 id=defense>Defense
<a class=anchor href=#defense>#</a></h2><p><a href=https://xsleaks.dev/docs/defenses/opt-in/xfo/>XFO</a> prevents embeds from being attacked because there&rsquo;s no visual difference as the content does not get shown.
The <em>Retrieving user&rsquo;s history</em> attack can only be prevented by the user.
This can be done by disabling the browser history, or if on Firefox, by setting the option <code>layout.css.visited_links_enabled</code> to <code>false</code> in <code>about:config</code> panel.</p><table><thead><tr><th style=text-align:center><a href=https://xsleaks.dev/docs/defenses/opt-in/same-site-cookies/>SameSite Cookies (Lax)</a></th><th style=text-align:center><a href=https://xsleaks.dev/docs/defenses/opt-in/coop/>COOP</a></th><th style=text-align:center><a href=https://xsleaks.dev/docs/defenses/opt-in/xfo/>Framing Protections</a></th><th style=text-align:center><a href=https://xsleaks.dev/docs/defenses/isolation-policies/>Isolation Policies</a></th></tr></thead><tbody><tr><td style=text-align:center>❌</td><td style=text-align:center>❌</td><td style=text-align:center>✔️</td><td style=text-align:center>❌</td></tr></tbody></table><h2 id=references>References
<a class=anchor href=#references>#</a></h2><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>Privacy and the :visited selector, <a href=https://developer.mozilla.org/en-US/docs/Web/CSS/Privacy_and_the_:visited_selector>link</a>&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2><p>CSS mix-blend-mode is bad for your browsing history, <a href=https://lcamtuf.blogspot.com/2016/08/css-mix-blend-mode-is-bad-for-keeping.html>link</a>&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:3><p>Pixel Perfect Timing Attacks with HTML5, <a href=https://owasp.org/www-pdf-archive/HackPra_Allstars-Browser_Timing_Attacks_-_Paul_Stone.pdf>link</a>&#160;<a href=#fnref:3 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:4><p>Visited links can be detected via redraw timing, <a href="https://bugs.chromium.org/p/chromium/issues/detail?id=252165">link</a>&#160;<a href=#fnref:4 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:5><p>XS-Leaking flags with CSS: A CTFd 0day, <a href=https://jorianwoltjer.com/blog/p/hacking/xs-leaking-flags-with-css-a-ctfd-0day>link</a>&#160;<a href=#fnref:5 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:6><p>The Human Side Channel, <a href=https://ronmasas.com/posts/the-human-side-channel>link</a>&#160;<a href=#fnref:6 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></p></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/xsleaks/wiki/commit/287baf16bc23dc3653b72afadaaa50e538bd907b title='Last modified by JorianWoltjer | July 3, 2024' target=_blank rel=noopener><img src=/svg/calendar.svg class=book-icon alt=Calendar>
<span>Last Modified: July 3, 2024</span></a></div><div><a class="flex align-center" href=https://github.com/xsleaks/wiki/edit/master/content/docs/attacks/css-tricks.md target=_blank rel=noopener><img src=/svg/edit.svg class=book-icon alt=Edit>
<span>Edit this article</span></a></div></div></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><nav id=TableOfContents><ul><li><a href=#css-tricks>CSS Tricks</a></li><li><a href=#retrieving-users-history>Retrieving user&rsquo;s history</a></li><li><a href=#leaking-status-code>Leaking status code</a></li><li><a href=#evil-captcha>Evil Captcha</a></li><li><a href=#abusing-autocomplete>Abusing autocomplete</a></li><li><a href=#custom-cursor>Custom cursor</a></li><li><a href=#defense>Defense</a></li><li><a href=#references>References</a></li></ul></nav></aside></main></body></html>