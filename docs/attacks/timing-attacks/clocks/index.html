<!doctype html><html lang=en dir=ZgotmplZ><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="We can distinguish two types of clocks – explicit and implicit. Explicit clocks are used by developers to get direct timing measurements, mechanisms of this type are offered explicitly by the browser. In contrast, implicit clocks utilize particular web features to create unintended clocks that allow measuring the relative passage of time.

  Explicit Clocks
  #


  performance.now API
  #

The performance.now() API allows developers to get high-resolution timing measurements.

  
    
      
        
      info"><meta name=theme-color content="#FFFFFF"><meta property="og:url" content="https://xsleaks.dev/docs/attacks/timing-attacks/clocks/"><meta property="og:site_name" content="XS-Leaks Wiki"><meta property="og:title" content="Clocks"><meta property="og:description" content="We can distinguish two types of clocks – explicit and implicit. Explicit clocks are used by developers to get direct timing measurements, mechanisms of this type are offered explicitly by the browser. In contrast, implicit clocks utilize particular web features to create unintended clocks that allow measuring the relative passage of time.
Explicit Clocks # performance.now API # The performance.now() API allows developers to get high-resolution timing measurements.
info"><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="docs"><meta property="article:published_time" content="2020-10-01T00:00:00+00:00"><meta property="article:modified_time" content="2020-12-23T11:21:20+01:00"><title>Clocks | XS-Leaks Wiki</title><link rel=manifest href=/manifest.json><link rel=icon href=/favicon.png type=image/x-icon><link rel=stylesheet href=/book.min.3e4293c95aca96b4ee60e121777d22919987757ee0af31973de12f0294bb3e38.css integrity="sha256-PkKTyVrKlrTuYOEhd30ikZmHdX7grzGXPeEvApS7Pjg="><script defer src=/en.search.min.221adc676e09b996f204295099466eb180b67277c164a32aa536a14d37fdfc4d.js integrity="sha256-IhrcZ24JuZbyBClQmUZusYC2cnfBZKMqpTahTTf9/E0="></script><script defer src=/sw.min.6f6f90fcb8eb1c49ec389838e6b801d0de19430b8e516902f8d75c3c8bd98739.js integrity="sha256-b2+Q/LjrHEnsOJg45rgB0N4ZQwuOUWkC+NdcPIvZhzk="></script></head><body dir=ZgotmplZ><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><nav><h2 class=book-brand><a href=/><span>XS-Leaks Wiki</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li class=book-section-flat><span>Attacks</span><ul><li><a href=/docs/attacks/xs-search/>XS-Search</a></li><li><a href=/docs/attacks/window-references/>Window References</a></li><li><a href=/docs/attacks/css-tricks/>CSS Tricks</a></li><li><a href=/docs/attacks/error-events/>Error Events</a></li><li><a href=/docs/attacks/frame-counting/>Frame Counting</a></li><li><a href=/docs/attacks/navigations/>Navigations</a></li><li><a href=/docs/attacks/cache-probing/>Cache Probing</a></li><li><a href=/docs/attacks/element-leaks/>Element leaks</a></li><li><a href=/docs/attacks/id-attribute/>ID Attribute</a></li><li><a href=/docs/attacks/postmessage-broadcasts/>postMessage Broadcasts</a></li><li><span>Browser Features</span><ul><li><a href=/docs/attacks/browser-features/corb/>CORB Leaks</a></li><li><a href=/docs/attacks/browser-features/corp/>CORP Leaks</a></li></ul></li><li><span>Timing Attacks</span><ul><li><a href=/docs/attacks/timing-attacks/clocks/ class=active>Clocks</a></li><li><a href=/docs/attacks/timing-attacks/network-timing/>Network Timing</a></li><li><a href=/docs/attacks/timing-attacks/performance-api/>Performance API</a></li><li><a href=/docs/attacks/timing-attacks/execution-timing/>Execution Timing</a></li><li><a href=/docs/attacks/timing-attacks/hybrid-timing/>Hybrid Timing</a></li><li><a href=/docs/attacks/timing-attacks/connection-pool/>Connection Pool</a></li></ul></li><li><a href=/docs/attacks/experiments/ class=collapsed>Experiments</a></li><li><a href=/docs/attacks/css-injection/>CSS Injection</a></li><li><a href=/docs/attacks/historical/ class=collapsed>Historical</a></li></ul></li><li class=book-section-flat><a href=/docs/defenses/>Defense Mechanisms</a><ul><li><a href=/docs/defenses/design-protections/>Application Design</a><ul><li><a href=/docs/defenses/design-protections/cache-protections/>Cache Protections</a></li><li><a href=/docs/defenses/design-protections/subresource-protections/>Subresource Protections</a></li></ul></li><li><a href=/docs/defenses/opt-in/>Opt-In Mechanisms</a><ul><li><a href=/docs/defenses/opt-in/fetch-metadata/>Fetch Metadata</a></li><li><a href=/docs/defenses/opt-in/coop/>Cross-Origin-Opener-Policy</a></li><li><a href=/docs/defenses/opt-in/corp/>Cross-Origin-Resource-Policy</a></li><li><a href=/docs/defenses/opt-in/xfo/>Framing Protections</a></li><li><a href=/docs/defenses/opt-in/same-site-cookies/>SameSite Cookies</a></li><li><a href=/docs/defenses/opt-in/document-policies/>Document Policies</a></li></ul></li><li><a href=/docs/defenses/isolation-policies/>Isolation Policies</a><ul><li><a href=/docs/defenses/isolation-policies/resource-isolation/>Resource Isolation Policy</a></li><li><a href=/docs/defenses/isolation-policies/framing-isolation/>Framing Isolation Policy</a></li><li><a href=/docs/defenses/isolation-policies/navigation-isolation/>Navigation Isolation Policy</a></li><li><a href=/docs/defenses/isolation-policies/strict-isolation/>Strict Isolation Policy</a></li></ul></li><li><a href=/docs/defenses/secure-defaults/>Secure Defaults</a><ul><li><a href=/docs/defenses/secure-defaults/corb/>Cross-Origin Read Blocking</a></li><li><a href=/docs/defenses/secure-defaults/partitioned-cache/>Partitioned HTTP Cache</a></li></ul></li></ul></li><li class=book-section-flat><a href=/docs/contributions/>Contributions</a><ul></ul></li></ul></nav><script>(function(){var e=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu>
</label><strong>Clocks</strong>
<label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#explicit-clocks>Explicit Clocks</a><ul><li><a href=#performancenow-api>performance.now API</a></li><li><a href=#date-api>Date API</a></li></ul></li><li><a href=#implicit-clocks>Implicit Clocks</a><ul><li><a href=#sharedarraybuffer-and-web-workers>SharedArrayBuffer and Web Workers</a></li><li><a href=#other-clocks>Other Clocks</a></li></ul></li><li><a href=#references>References</a></li></ul></nav></aside></header><article class=markdown><h1>Clocks</h1><h5>October 1, 2020</h5><p><p>We can distinguish two types of clocks – explicit and implicit. Explicit clocks are used by developers to get direct timing measurements, mechanisms of this type are offered explicitly by the browser. In contrast, implicit clocks utilize particular web features to create unintended clocks that allow measuring the relative passage of time.</p><h2 id=explicit-clocks>Explicit Clocks
<a class=anchor href=#explicit-clocks>#</a></h2><h3 id=performancenow-api>performance.now API
<a class=anchor href=#performancenow-api>#</a></h3><p>The <a href=https://developer.mozilla.org/en-US/docs/Web/API/Performance/now>performance.now()</a> API allows developers to get high-resolution timing measurements.</p><blockquote class="book-hint2 info"><p class="hint-title info"><svg class="book-icon"><use href="/svg/hint-icons.svg#info-notice"/></svg><span>info</span></p><p>In order to mitigate some types of XS-Leaks, <code>performance.now()</code>&rsquo;s accuracy was reduced from a range of nanoseconds to microsecond precision in all modern browsers <sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup> <sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup> <sup id=fnref:3><a href=#fn:3 class=footnote-ref role=doc-noteref>3</a></sup>.</p><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>Reduce resolution of performance.now (Webkit). <a href="https://bugs.webkit.org/show_bug.cgi?id=146531">link</a>&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2><p>Reduce precision of performance.now() to 20us (Gecko). <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1427870">link</a>&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:3><p>Reduce resolution of performance.now to prevent timing attacks (Blink). <a href="https://bugs.chromium.org/p/chromium/issues/detail?id=506723">link</a>&#160;<a href=#fnref:3 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></blockquote><h3 id=date-api>Date API
<a class=anchor href=#date-api>#</a></h3><p>The <a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date>Date</a> API is the oldest API present in browsers which can be used to obtain timing measurements. It allows developers to get dates, and get Unix timestamps with <code>Date.now()</code>. These measurements are much less precise than <a href=https://developer.mozilla.org/en-US/docs/Web/API/Performance/now>performance.now()</a>. Before the introduction of newer APIs, attacks used to leverage this API <sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>.</p><h2 id=implicit-clocks>Implicit Clocks
<a class=anchor href=#implicit-clocks>#</a></h2><h3 id=sharedarraybuffer-and-web-workers>SharedArrayBuffer and Web Workers
<a class=anchor href=#sharedarraybuffer-and-web-workers>#</a></h3><p>With the introduction of <code>Web Workers</code>, new mechanisms to exchange data between threads were created <sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup>. One of those mechanisms is <code>SharedArrayBuffer</code> which provides memory sharing between the main thread and a worker thread. A malicious website can create an implicit clock by loading a worker running an infinite loop that increments a number in the buffer. This value can then be accessed by the main thread at any time to read how many incrementations were performed.</p><blockquote class="book-hint2 info"><p class="hint-title info"><svg class="book-icon"><use href="/svg/hint-icons.svg#info-notice"/></svg><span>info</span></p><p><code>SharedArrayBuffer</code> was removed from browsers with the publication of <a href=https://spectreattack.com/>Spectre</a>. It was reintroduced later in 2020, requiring documents to be in a <a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/SharedArrayBuffer>secure context</a> to make use of the API. Since secure contexts cannot reference any cross-origin content that has not explicitly opted in to being accessed, this means SharedArrayBuffers cannot be used as clocks for some XS-Leaks.</p><p>To make use of <code>SharedArrayBuffer</code> in modern browsers, an application needs to explicitly opt in to <a href=https://xsleaks.dev/docs/defenses/opt-in/coop/>COOP</a> and <a href=https://web.dev/coop-coep/>COEP</a> by setting the following headers:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-http data-lang=http><span style=display:flex><span>Cross-Origin-Opener-Policy: same-origin
</span></span><span style=display:flex><span>Cross-Origin-Embedder-Policy: require-corp
</span></span></code></pre></div></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#6272a4>// Define a function to be ran inside a WebWorker
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span><span style=color:#8be9fd;font-style:italic>function</span> worker_function() {
</span></span><span style=display:flex><span>  self.onmessage <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>function</span> (event) {
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>const</span> sharedBuffer <span style=color:#ff79c6>=</span> event.data;
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>const</span> sharedArray <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>new</span> Uint32Array(sharedBuffer);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#6272a4>// Infinitely increase the uint32 number
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    <span style=color:#ff79c6>while</span> (<span style=color:#ff79c6>true</span>) Atomics.add(sharedArray, <span style=color:#bd93f9>0</span>, <span style=color:#bd93f9>1</span>);
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// Create the WebWorker from the JS function and invoke it
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span><span style=color:#ff79c6>const</span> worker <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>new</span> Worker(
</span></span><span style=display:flex><span>  URL.createObjectURL(
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>new</span> Blob([<span style=color:#f1fa8c>`(</span><span style=color:#f1fa8c>${</span>worker_function<span style=color:#f1fa8c>}</span><span style=color:#f1fa8c>)()`</span>], {
</span></span><span style=display:flex><span>      type<span style=color:#ff79c6>:</span> <span style=color:#f1fa8c>&#34;text/javascript&#34;</span>
</span></span><span style=display:flex><span>    }))
</span></span><span style=display:flex><span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// Create a Shared buffer between the WebWorker and a document
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span><span style=color:#ff79c6>const</span> sharedBuffer <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>new</span> SharedArrayBuffer(Uint32Array.BYTES_PER_ELEMENT);
</span></span><span style=display:flex><span><span style=color:#ff79c6>const</span> sharedArray <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>new</span> Uint32Array(sharedBuffer);
</span></span><span style=display:flex><span>worker.postMessage(sharedBuffer);
</span></span></code></pre></div><blockquote class="book-hint2 tip"><p class="hint-title tip"><svg class="book-icon"><use href="/svg/hint-icons.svg#tip-notice"/></svg><span>tip</span></p><p>To get the relative time in a main thread, you can use the <a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Atomics>Atomics API</a>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span>Atomics.load(sharedArray, <span style=color:#bd93f9>0</span>);
</span></span></code></pre></div></blockquote><h3 id=other-clocks>Other Clocks
<a class=anchor href=#other-clocks>#</a></h3><p>There are a considerable number of APIs attackers can abuse to create implicit clocks: <a href=https://developer.mozilla.org/en-US/docs/Web/API/Broadcast_Channel_API>Broadcast Channel API</a>, <a href=https://developer.mozilla.org/en-US/docs/Web/API/MessageChannel>Message Channel API</a>, <a href=https://developer.mozilla.org/en-US/docs/Web/API/window/requestAnimationFrame>requestAnimationFrame</a>, <a href=https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/setTimeout>setTimeout</a>, CSS animations, and others <sup id=fnref:3><a href=#fn:3 class=footnote-ref role=doc-noteref>3</a></sup> <sup id=fnref:4><a href=#fn:4 class=footnote-ref role=doc-noteref>4</a></sup>.</p><h2 id=references>References
<a class=anchor href=#references>#</a></h2><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>Exposing Private Information by Timing Web Applications, <a href=http://crypto.stanford.edu/~dabo/papers/webtiming.pdf>link</a>&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2><p>Shared memory: Side-channel information leaks, <a href=https://github.com/tc39/ecmascript_sharedmem/blob/master/issues/TimingAttack.md>link</a>&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:3><p>Fantastic Timers and Where to Find Them: High-Resolution Microarchitectural Attacks in JavaScript, <a href=https://gruss.cc/files/fantastictimers.pdf>link</a>&#160;<a href=#fnref:3 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:4><p>Trusted Browsers for Uncertain Times, <a href=https://www.usenix.org/system/files/conference/usenixsecurity16/sec16_paper_kohlbrenner.pdf>link</a>&#160;<a href=#fnref:4 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></p></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/xsleaks/wiki/commit/aa00639d1063bdf903253cf1654fff871123e566 title='Last modified by goedi02 | December 23, 2020' target=_blank rel=noopener><img src=/svg/calendar.svg class=book-icon alt=Calendar>
<span>Last Modified: December 23, 2020</span></a></div><div><a class="flex align-center" href=https://github.com/xsleaks/wiki/edit/master/content/docs/attacks/timing-attacks/clocks.md target=_blank rel=noopener><img src=/svg/edit.svg class=book-icon alt=Edit>
<span>Edit this article</span></a></div></div></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><nav id=TableOfContents><ul><li><a href=#explicit-clocks>Explicit Clocks</a><ul><li><a href=#performancenow-api>performance.now API</a></li><li><a href=#date-api>Date API</a></li></ul></li><li><a href=#implicit-clocks>Implicit Clocks</a><ul><li><a href=#sharedarraybuffer-and-web-workers>SharedArrayBuffer and Web Workers</a></li><li><a href=#other-clocks>Other Clocks</a></li></ul></li><li><a href=#references>References</a></li></ul></nav></aside></main></body></html>