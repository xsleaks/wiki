<!doctype html><html lang=en dir=ZgotmplZ><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="
  Performance API
  #

The Performance API provides access to performance-related information enhanced by the data from the Resource Timing API
which provides the timings of network requests such as the duration but when there’s a Timing-Allow-Origin: * header sent by the server the transfer size and domain lookup time is also provided.
This data can be accessed by using performance.getEntries or performance.getEntriesByName
It can also be used to get the execution time using the difference of performance.now() however this seems to be less precise for a chrome fetch because it only provides the milliseconds."><meta name=theme-color content="#FFFFFF"><meta property="og:url" content="https://xsleaks.dev/docs/attacks/timing-attacks/performance-api/"><meta property="og:site_name" content="XS-Leaks Wiki"><meta property="og:title" content="Performance API"><meta property="og:description" content="Performance API # The Performance API provides access to performance-related information enhanced by the data from the Resource Timing API which provides the timings of network requests such as the duration but when there’s a Timing-Allow-Origin: * header sent by the server the transfer size and domain lookup time is also provided.
This data can be accessed by using performance.getEntries or performance.getEntriesByName It can also be used to get the execution time using the difference of performance.now() however this seems to be less precise for a chrome fetch because it only provides the milliseconds."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="docs"><meta property="article:published_time" content="2020-10-01T00:00:00+00:00"><meta property="article:modified_time" content="2024-04-21T20:35:32+01:00"><title>Performance API | XS-Leaks Wiki</title>
<link rel=manifest href=/manifest.json><link rel=icon href=/favicon.png type=image/x-icon><link rel=stylesheet href=/book.min.1c9a9009be3c645cbccbe64eb0a90e28621e4118971d9a502db4aaa9bec96cfc.css integrity="sha256-HJqQCb48ZFy8y+ZOsKkOKGIeQRiXHZpQLbSqqb7JbPw="><script defer src=/en.search.min.4b0a0e5c472b82ce2e0b8fb53b12f2357a995b4df3e5361e577dddec4f0aa8b4.js integrity="sha256-SwoOXEcrgs4uC4+1OxLyNXqZW03z5TYeV33d7E8KqLQ="></script><script defer src=/sw.min.6f6f90fcb8eb1c49ec389838e6b801d0de19430b8e516902f8d75c3c8bd98739.js integrity="sha256-b2+Q/LjrHEnsOJg45rgB0N4ZQwuOUWkC+NdcPIvZhzk="></script></head><body dir=ZgotmplZ><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><nav><h2 class=book-brand><a href=/><span>XS-Leaks Wiki</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li class=book-section-flat><span>Attacks</span><ul><li><a href=/docs/attacks/xs-search/>XS-Search</a></li><li><a href=/docs/attacks/window-references/>Window References</a></li><li><a href=/docs/attacks/css-tricks/>CSS Tricks</a></li><li><a href=/docs/attacks/error-events/>Error Events</a></li><li><a href=/docs/attacks/frame-counting/>Frame Counting</a></li><li><a href=/docs/attacks/navigations/>Navigations</a></li><li><a href=/docs/attacks/cache-probing/>Cache Probing</a></li><li><a href=/docs/attacks/element-leaks/>Element leaks</a></li><li><a href=/docs/attacks/id-attribute/>ID Attribute</a></li><li><a href=/docs/attacks/postmessage-broadcasts/>postMessage Broadcasts</a></li><li><span>Browser Features</span><ul><li><a href=/docs/attacks/browser-features/corb/>CORB Leaks</a></li><li><a href=/docs/attacks/browser-features/corp/>CORP Leaks</a></li></ul></li><li><span>Timing Attacks</span><ul><li><a href=/docs/attacks/timing-attacks/clocks/>Clocks</a></li><li><a href=/docs/attacks/timing-attacks/network-timing/>Network Timing</a></li><li><a href=/docs/attacks/timing-attacks/performance-api/ class=active>Performance API</a></li><li><a href=/docs/attacks/timing-attacks/execution-timing/>Execution Timing</a></li><li><a href=/docs/attacks/timing-attacks/hybrid-timing/>Hybrid Timing</a></li><li><a href=/docs/attacks/timing-attacks/connection-pool/>Connection Pool</a></li></ul></li><li><a href=/docs/attacks/experiments/ class=collapsed>Experiments</a></li><li><a href=/docs/attacks/css-injection/>CSS Injection</a></li><li><a href=/docs/attacks/historical/ class=collapsed>Historical</a></li></ul></li><li class=book-section-flat><a href=/docs/defenses/>Defense Mechanisms</a><ul><li><a href=/docs/defenses/design-protections/>Application Design</a><ul><li><a href=/docs/defenses/design-protections/cache-protections/>Cache Protections</a></li><li><a href=/docs/defenses/design-protections/subresource-protections/>Subresource Protections</a></li></ul></li><li><a href=/docs/defenses/opt-in/>Opt-In Mechanisms</a><ul><li><a href=/docs/defenses/opt-in/fetch-metadata/>Fetch Metadata</a></li><li><a href=/docs/defenses/opt-in/coop/>Cross-Origin-Opener-Policy</a></li><li><a href=/docs/defenses/opt-in/corp/>Cross-Origin-Resource-Policy</a></li><li><a href=/docs/defenses/opt-in/xfo/>Framing Protections</a></li><li><a href=/docs/defenses/opt-in/same-site-cookies/>SameSite Cookies</a></li><li><a href=/docs/defenses/opt-in/document-policies/>Document Policies</a></li></ul></li><li><a href=/docs/defenses/isolation-policies/>Isolation Policies</a><ul><li><a href=/docs/defenses/isolation-policies/resource-isolation/>Resource Isolation Policy</a></li><li><a href=/docs/defenses/isolation-policies/framing-isolation/>Framing Isolation Policy</a></li><li><a href=/docs/defenses/isolation-policies/navigation-isolation/>Navigation Isolation Policy</a></li><li><a href=/docs/defenses/isolation-policies/strict-isolation/>Strict Isolation Policy</a></li></ul></li><li><a href=/docs/defenses/secure-defaults/>Secure Defaults</a><ul><li><a href=/docs/defenses/secure-defaults/corb/>Cross-Origin Read Blocking</a></li><li><a href=/docs/defenses/secure-defaults/partitioned-cache/>Partitioned HTTP Cache</a></li></ul></li></ul></li><li class=book-section-flat><a href=/docs/contributions/>Contributions</a><ul></ul></li></ul></nav><script>(function(){var e=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu>
</label><strong>Performance API</strong>
<label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#performance-api>Performance API</a></li><li><a href=#network-duration>Network duration</a></li><li><a href=#detecting-x-frame-options>Detecting X-Frame-Options</a></li></ul><ul><li><a href=#connection-speed>Connection speed</a></li></ul></nav></aside></header><article class=markdown><h1>Performance API</h1><h5>October 1, 2020</h5><p><h2 id=performance-api>Performance API
<a class=anchor href=#performance-api>#</a></h2><p>The <a href=https://developer.mozilla.org/en-US/docs/Web/API/Performance><code>Performance API</code></a> provides access to performance-related information enhanced by the data from the <a href=https://developer.mozilla.org/en-US/docs/Web/API/Resource_Timing_API><code>Resource Timing API</code></a>
which provides the timings of network requests such as the duration but when there’s a <code>Timing-Allow-Origin: *</code> header sent by the server the transfer size and domain lookup time is also provided.<br>This data can be accessed by using <a href=https://developer.mozilla.org/en-US/docs/Web/API/Performance/getEntries><code>performance.getEntries</code></a> or <a href=https://developer.mozilla.org/en-US/docs/Web/API/Performance/getEntriesByName><code>performance.getEntriesByName</code></a>
It can also be used to get the execution time using the difference of <a href=https://developer.mozilla.org/en-US/docs/Web/API/Performance/now><code>performance.now()</code></a> however this seems to be less precise for a chrome fetch because it only provides the milliseconds.</p><h2 id=network-duration>Network duration
<a class=anchor href=#network-duration>#</a></h2><p>It is possible to retrieve the network duration of a request from the <code>performance</code> API.</p><p>The below snippet performs a network request then after 200ms it gets the duration from the <code>performance</code> object.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#ff79c6>async</span> <span style=color:#8be9fd;font-style:italic>function</span> getNetworkDuration(url) {
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>let</span> href <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>new</span> URL(url).href;
</span></span><span style=display:flex><span>    <span style=color:#6272a4>// Using an image instead of fetch() as some requests had duration = 0
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    <span style=color:#8be9fd;font-style:italic>let</span> image <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>new</span> Image().src <span style=color:#ff79c6>=</span> href;
</span></span><span style=display:flex><span>    <span style=color:#6272a4>// Wait for request to be added to performance.getEntriesByName();
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    <span style=color:#ff79c6>await</span> <span style=color:#ff79c6>new</span> <span style=color:#8be9fd;font-style:italic>Promise</span>(r =&gt; setTimeout(r, <span style=color:#bd93f9>200</span>));
</span></span><span style=display:flex><span>    <span style=color:#6272a4>// Get last added timings
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    <span style=color:#8be9fd;font-style:italic>let</span> res <span style=color:#ff79c6>=</span> performance.getEntriesByName(href).pop();
</span></span><span style=display:flex><span>    console.log(<span style=color:#f1fa8c>&#34;Request duration: &#34;</span> <span style=color:#ff79c6>+</span> res.duration);
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>return</span> res.duration
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>await</span> getNetworkDuration(<span style=color:#f1fa8c>&#39;https://example.org&#39;</span>);
</span></span></code></pre></div><blockquote class="book-hint2 info"><p class="hint-title info"><svg class="book-icon"><use href="/svg/hint-icons.svg#info-notice"/></svg><span>info</span></p>Unlike other browsers, Firefox provides the measurements in milliseconds.</blockquote><h2 id=detecting-x-frame-options>Detecting X-Frame-Options
<a class=anchor href=#detecting-x-frame-options>#</a></h2><p>If displaying a page inside an embed (e.g. because of the <code>X-Frame-Options</code> header) it will not be added to the <code>performance</code> object in Chrome. <a href=https://xsinator.com/testing.html#Performance%20API%20X-Frame%20Leak>Run demo</a></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#ff79c6>async</span> <span style=color:#8be9fd;font-style:italic>function</span> isFrameBlocked(url) {
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>let</span> href <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>new</span> URL(url).href;
</span></span><span style=display:flex><span>    <span style=color:#6272a4>// There may be requests for this url before the function was run.
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    <span style=color:#8be9fd;font-style:italic>let</span> start_count <span style=color:#ff79c6>=</span> performance.getEntriesByName(href).length;
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>let</span> embed <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>document</span>.createElement(<span style=color:#f1fa8c>&#39;embed&#39;</span>);
</span></span><span style=display:flex><span>    embed.setAttribute(<span style=color:#f1fa8c>&#34;hidden&#34;</span>, <span style=color:#ff79c6>true</span>);
</span></span><span style=display:flex><span>    embed.src <span style=color:#ff79c6>=</span> href;
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>document</span>.body.appendChild(embed);
</span></span><span style=display:flex><span>    <span style=color:#6272a4>// Wait for request to be added to performance.getEntriesByName();
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    <span style=color:#ff79c6>await</span> <span style=color:#ff79c6>new</span> <span style=color:#8be9fd;font-style:italic>Promise</span>(r =&gt; setTimeout(r, <span style=color:#bd93f9>1000</span>));
</span></span><span style=display:flex><span>    <span style=color:#6272a4>// Remove test embed
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    <span style=color:#8be9fd;font-style:italic>document</span>.body.removeChild(embed)
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>return</span> performance.getEntriesByName(href).length <span style=color:#ff79c6>===</span> start_count;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>await</span> isFrameBlocked(<span style=color:#f1fa8c>&#39;https://example.org&#39;</span>);
</span></span></code></pre></div><blockquote class="book-hint2 note"><p class="hint-title note"><svg class="book-icon"><use href="/svg/hint-icons.svg#note-notice"/></svg><span>note</span></p>This technique does seem to only work in Chromium based browsers</blockquote><h1 id=detecting-cached-resources>Detecting cached resources
<a class=anchor href=#detecting-cached-resources>#</a></h1><p>With the <code>performance</code> API it is possible to detect whether a resource was cached or not.
Unless <a href=https://xsleaks.dev/docs/defenses/secure-defaults/corb/>Cross-Origin Read Blocking</a> is triggered (resource is html) the resource will get cached in the process of the check. <a href=https://xsinator.com/testing.html#Duration%20Redirect%20Leak>Run demo</a></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#ff79c6>async</span> <span style=color:#8be9fd;font-style:italic>function</span> ifCached2(url) {
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>let</span> href <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>new</span> URL(url).href;
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>await</span> fetch(href, {mode<span style=color:#ff79c6>:</span> <span style=color:#f1fa8c>&#34;no-cors&#34;</span>, credentials<span style=color:#ff79c6>:</span> <span style=color:#f1fa8c>&#34;include&#34;</span>});
</span></span><span style=display:flex><span>    <span style=color:#6272a4>// Wait for request to be added to performance.getEntriesByName();
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    <span style=color:#ff79c6>await</span> <span style=color:#ff79c6>new</span> <span style=color:#8be9fd;font-style:italic>Promise</span>(r =&gt; setTimeout(r, <span style=color:#bd93f9>200</span>));
</span></span><span style=display:flex><span>    <span style=color:#6272a4>// Get last added timings
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    <span style=color:#8be9fd;font-style:italic>let</span> res <span style=color:#ff79c6>=</span> performance.getEntriesByName(href).pop();
</span></span><span style=display:flex><span>    console.log(<span style=color:#f1fa8c>&#34;Request duration: &#34;</span> <span style=color:#ff79c6>+</span> res.duration);
</span></span><span style=display:flex><span>    <span style=color:#6272a4>// Check if is 304
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    <span style=color:#ff79c6>if</span> (res.encodedBodySize <span style=color:#ff79c6>&gt;</span> <span style=color:#bd93f9>0</span> <span style=color:#ff79c6>&amp;&amp;</span> res.transferSize <span style=color:#ff79c6>&gt;</span> <span style=color:#bd93f9>0</span> <span style=color:#ff79c6>&amp;&amp;</span> res.transferSize <span style=color:#ff79c6>&lt;</span> res.encodedBodySize) <span style=color:#ff79c6>return</span> <span style=color:#ff79c6>true</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>if</span> (res.transferSize <span style=color:#ff79c6>&gt;</span> <span style=color:#bd93f9>0</span>) <span style=color:#ff79c6>return</span> <span style=color:#ff79c6>false</span>;
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>if</span> (res.decodedBodySize <span style=color:#ff79c6>&gt;</span> <span style=color:#bd93f9>0</span>) <span style=color:#ff79c6>return</span> <span style=color:#ff79c6>true</span>;
</span></span><span style=display:flex><span>    <span style=color:#6272a4>// Use duration if theirs no Timing-Allow-Origin header
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    <span style=color:#ff79c6>return</span> res.duration <span style=color:#ff79c6>&lt;</span> <span style=color:#bd93f9>10</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=connection-speed>Connection speed
<a class=anchor href=#connection-speed>#</a></h2><p>It is possible to measure the speed of the connection in octets.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#ff79c6>async</span> <span style=color:#8be9fd;font-style:italic>function</span> getSpeed(count <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>10</span>) {
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>var</span> total <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>;
</span></span><span style=display:flex><span>    <span style=color:#6272a4>// Make multiple requests for average
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    <span style=color:#ff79c6>for</span> (<span style=color:#8be9fd;font-style:italic>let</span> i <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>; i <span style=color:#ff79c6>&lt;</span> count; i<span style=color:#ff79c6>++</span>) {
</span></span><span style=display:flex><span>        <span style=color:#6272a4>// Make request to the current origin bypassing cache
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>        <span style=color:#ff79c6>await</span> fetch(location.href, {cache<span style=color:#ff79c6>:</span> <span style=color:#f1fa8c>&#34;no-store&#34;</span>});
</span></span><span style=display:flex><span>        <span style=color:#6272a4>// Wait for timings to get added
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>        <span style=color:#ff79c6>await</span> <span style=color:#ff79c6>new</span> <span style=color:#8be9fd;font-style:italic>Promise</span>(r =&gt; setTimeout(r, <span style=color:#bd93f9>200</span>));
</span></span><span style=display:flex><span>        <span style=color:#6272a4>// Get latest timing for location
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>        <span style=color:#8be9fd;font-style:italic>let</span> page <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>window</span>.performance.getEntriesByName(location.href).pop();
</span></span><span style=display:flex><span>        <span style=color:#6272a4>// Get response time divided by transferSize
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>        total <span style=color:#ff79c6>+=</span> (page.responseEnd <span style=color:#ff79c6>-</span> page.responseStart) <span style=color:#ff79c6>/</span> page.transferSize;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#6272a4>// Get average response time for requests
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    <span style=color:#ff79c6>return</span> total<span style=color:#ff79c6>/</span>count
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>await</span> averageSpeed <span style=color:#ff79c6>=</span> getSpeed();
</span></span></code></pre></div></p></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/xsleaks/wiki/commit/4405beed14707dd730e02fe2c825c7924ed08c2b title='Last modified by NDevTK | April 21, 2024' target=_blank rel=noopener><img src=/svg/calendar.svg class=book-icon alt=Calendar>
<span>Last Modified: April 21, 2024</span></a></div><div><a class="flex align-center" href=https://github.com/xsleaks/wiki/edit/master/content/docs/attacks/timing-attacks/performance-api.md target=_blank rel=noopener><img src=/svg/edit.svg class=book-icon alt=Edit>
<span>Edit this article</span></a></div></div></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><nav id=TableOfContents><ul><li><a href=#performance-api>Performance API</a></li><li><a href=#network-duration>Network duration</a></li><li><a href=#detecting-x-frame-options>Detecting X-Frame-Options</a></li></ul><ul><li><a href=#connection-speed>Connection speed</a></li></ul></nav></aside></main></body></html>