<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Scroll to Text Fragment (STTF) is a new web platform feature that allows users to create a link to any part of a web page text. The fragment #:~:text= carries a text snippet that is highlighted and brought into the viewport by the browser. This feature can introduce a new XS-Leak if attackers are able to detect when this behavior occurs. This issue is very similar to the Scroll to CSS Selector XS-Leak."><meta name=theme-color content="#FFFFFF"><meta property="og:title" content="Scroll to Text Fragment"><meta property="og:description" content="Scroll to Text Fragment (STTF) is a new web platform feature that allows users to create a link to any part of a web page text. The fragment #:~:text= carries a text snippet that is highlighted and brought into the viewport by the browser. This feature can introduce a new XS-Leak if attackers are able to detect when this behavior occurs. This issue is very similar to the Scroll to CSS Selector XS-Leak."><meta property="og:type" content="article"><meta property="og:url" content="https://xsleaks.com/docs/attacks/experiments/scroll-to-text-fragment/"><meta property="article:published_time" content="2020-10-01T00:00:00+00:00"><meta property="article:modified_time" content="2020-10-14T14:05:24-07:00"><title>Scroll to Text Fragment | XS-Leaks Wiki</title><link rel=manifest href=/manifest.json><link rel=icon href=/favicon.png type=image/x-icon><link rel=stylesheet href=/book.min.092646ee0a13bc3d434088e3ef209623b91ad8714e3f5b61c7d3d1a096669ae7.css integrity="sha256-CSZG7goTvD1DQIjj7yCWI7ka2HFOP1thx9PRoJZmmuc="><script defer src=/en.search.min.f4cf080cf74978f9802e5a76c8965ef1719b508fe4c4201d143a5cd236d734cb.js integrity="sha256-9M8IDPdJePmALlp2yJZe8XGbUI/kxCAdFDpc0jbXNMs="></script><script defer src=/sw.min.74a8bb07f0bee86d6bb9a2750f073f14d93c7e4512f28860370cfd879e9719b4.js integrity="sha256-dKi7B/C+6G1ruaJ1Dwc/FNk8fkUS8ohgNwz9h56XGbQ="></script></head><body><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><nav><h2 class=book-brand><a href=/><span>XS-Leaks Wiki</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li class=book-section-flat><span>Attacks</span><ul><li><a href=/docs/attacks/xs-search/>XS-Search</a></li><li><a href=/docs/attacks/error-events/>Error Events</a></li><li><a href=/docs/attacks/frame-counting/>Frame Counting</a></li><li><a href=/docs/attacks/navigations/>Navigations</a></li><li><a href=/docs/attacks/cache-probing/>Cache Probing</a></li><li><a href=/docs/attacks/id-attribute/>ID Attribute</a></li><li><a href=/docs/attacks/postmessage-broadcasts/>postMessage Broadcasts</a></li><li><span>Browser Features</span><ul><li><a href=/docs/attacks/browser-features/corb/>CORB Leaks</a></li><li><a href=/docs/attacks/browser-features/corp/>CORP Leaks</a></li></ul></li><li><span>Timing Attacks</span><ul><li><a href=/docs/attacks/timing-attacks/clocks/>Clocks</a></li><li><a href=/docs/attacks/timing-attacks/network-timing/>Network Timing</a></li><li><a href=/docs/attacks/timing-attacks/execution-timing/>Execution Timing</a></li><li><a href=/docs/attacks/timing-attacks/hybrid-timing/>Hybrid Timing</a></li><li><a href=/docs/attacks/timing-attacks/connection-pool/>Connection Pool</a></li></ul></li><li><a href=/docs/attacks/experiments/ class=collapsed>Experiments</a><ul><li><a href=/docs/attacks/experiments/portals/>Portals</a></li><li><a href=/docs/attacks/experiments/scroll-to-text-fragment/ class=active>Scroll to Text Fragment</a></li></ul></li><li><a href=/docs/attacks/historical/ class=collapsed>Historical</a></li></ul></li><li class=book-section-flat><a href=/docs/defenses/>Defense Mechanisms</a><ul><li><a href=/docs/defenses/design-protections/>Application Design</a><ul><li><a href=/docs/defenses/design-protections/cache-protections/>Cache Protections</a></li><li><a href=/docs/defenses/design-protections/subresource-protections/>Subresource Protections</a></li></ul></li><li><a href=/docs/defenses/opt-in/>Opt-In Mechanisms</a><ul><li><a href=/docs/defenses/opt-in/coop/>Cross-Origin-Opener-Policy</a></li><li><a href=/docs/defenses/opt-in/corp/>Cross-Origin-Resource-Policy</a></li><li><a href=/docs/defenses/opt-in/fetch-metadata/>Fetch Metadata</a></li><li><a href=/docs/defenses/opt-in/xfo/>Framing Protections</a></li><li><a href=/docs/defenses/opt-in/same-site-cookies/>Same-Site Cookies</a></li></ul></li><li><a href=/docs/defenses/secure-defaults/>Secure Defaults</a><ul><li><a href=/docs/defenses/secure-defaults/corb/>Cross-Origin Read Blocking</a></li><li><a href=/docs/defenses/secure-defaults/partitioned-cache/>Partitioned HTTP Cache</a></li></ul></li></ul></li></ul></nav><script>(function(){var menu=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(event){localStorage.setItem("menu.scrollTop",menu.scrollTop);});menu.scrollTop=localStorage.getItem("menu.scrollTop");})();</script></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label>
<strong>Scroll to Text Fragment</strong>
<label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#expected--discussed-issues>Expected & Discussed Issues</a></li><li><a href=#current-issues>Current Issues</a></li><li><a href=#why-is-this-a-problem>Why is this a problem?</a><ul><li><a href=#case-scenarios>Case Scenarios</a></li></ul></li><li><a href=#defense>Defense</a></li><li><a href=#references>References</a></li></ul></nav></aside></header><article class=markdown><h1>Scroll to Text Fragment</h1><h5>October 1, 2020</h5><div>Abuse
<a href=/abuse/onblur/>onblur</a>,
<a href=/abuse/focus/>focus</a>,
<a href=/abuse/iframes/>iframes</a></div><div>Category
<a href=/category/experiments/>Experiments</a></div><p><p>Scroll to Text Fragment (STTF) is a new web platform feature that allows users to create a link to any part of a web page text. The fragment <code>#:~:text=</code> carries a text snippet that is highlighted and brought into the viewport by the browser. This feature can introduce a new XS-Leak if attackers are able to detect when this behavior occurs. This issue is very similar to the <a href="https://docs.google.com/document/d/15HVLD6nddA0OaI8Dd0ayBP2jlGw5JpRD-njAyY1oNZo/edit#heading=h.wds2qckm3kh5">Scroll to CSS Selector</a> XS-Leak.</p><h2 id=expected--discussed-issues>Expected & Discussed Issues
<a class=anchor href=#expected--discussed-issues>#</a></h2><p>In early discussions for the specification of this feature it was shown that several XS-Leaks could be introduced with a naïve implementation <sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>. The specification considers various attack scenarios <sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup>, as does some research from Google <sup id=fnref:3><a href=#fn:3 class=footnote-ref role=doc-noteref>3</a></sup>. One possible XS-Leak browsers need to be aware of when implementing this feature is:</p><ul><li>An attacker can, by embedding a page as an <code>iframe</code>, detect whether the page scrolled to the text by listening to the <code>onblur</code> of the parent document. This approach is similar to the <a href=https://xsleaks.com/docs/attacks/id-attribute/>ID Attribute XS-Leak</a>. This scenario is mitigated in the Chrome implementation <sup id=fnref:4><a href=#fn:4 class=footnote-ref role=doc-noteref>4</a></sup> as it only allows the fragment navigation to occur in top-level navigations.</li></ul><h2 id=current-issues>Current Issues
<a class=anchor href=#current-issues>#</a></h2><blockquote class="book-hint info">These XS-Leaks require some type of markup injection on the target page.</blockquote><p>During the development process of STTF new attacks and tricks to detect a fragment navigation were found. Some of them still work:</p><ul><li>A web page that embeds an attacker-controlled <code>iframe</code> might allow the attacker to determine whether a scroll to the text has occurred. This can be done using the <a href=https://developer.mozilla.org/en-US/docs/Web/API/Intersection_Observer_API><code>IntersectionObserver</code></a> API <sup id=fnref:5><a href=#fn:5 class=footnote-ref role=doc-noteref>5</a></sup> <sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup> <sup id=fnref:3><a href=#fn:3 class=footnote-ref role=doc-noteref>3</a></sup>.</li><li>If a page contains images with <a href=https://web.dev/native-lazy-loading/>Lazy Loading</a> an attacker might known if a fragment navigation that included an image occurred by checking whether it was <a href=https://xsleaks.com/docs/attacks/cache-probing/>cached in the browser</a>. This occurs because <a href=https://web.dev/native-lazy-loading/>Lazy Loading</a> images are only fetched (and cached) when they appear in the viewport.</li></ul><blockquote class="book-hint warning">Scroll to Text Fragment is only available in Chrome. Its <a href=https://wicg.github.io/scroll-to-text-fragment/>draft</a> specification is under active discussion.</blockquote><blockquote class="book-hint good">Scroll to Text Fragment XS-Leaks allow attackers to extract 1 bit of information at a time as it&rsquo;s only possible to observe whether a group of words is present in a page. This occurs as STTF matching mechanism is based on words, so attackers won&rsquo;t be able to leak information character by character.</blockquote><h2 id=why-is-this-a-problem>Why is this a problem?
<a class=anchor href=#why-is-this-a-problem>#</a></h2><p>Attackers can abuse STTF to leak private information about the user since its highly connected with the contents of a web page.</p><h3 id=case-scenarios>Case Scenarios
<a class=anchor href=#case-scenarios>#</a></h3><ul><li>A user is logged in its National Health System website, where it is possible to access information about the user past diseases and health problems. An attacker can lure the user to one of its pages and use STTF to possibly infer specific deceases of the user. For example an attacker would find out if the victim suffers of a disease if they detects a page scroll when searching for that pathology name.</li></ul><h2 id=defense>Defense
<a class=anchor href=#defense>#</a></h2><table><thead><tr><th style=text-align:center>Attack Alternative</th><th style=text-align:center><a href=https://xsleaks.com/docs/defenses/opt-in/same-site-cookies/>Same-Site Cookies</a></th><th style=text-align:center><a href=https://xsleaks.com/docs/defenses/opt-in/fetch-metadata/>Fetch Metadata</a></th><th style=text-align:center><a href=https://xsleaks.com/docs/defenses/opt-in/coop/>COOP</a></th><th style=text-align:center><a href=https://xsleaks.com/docs/defenses/opt-in/xfo/>Framing Protections</a></th></tr></thead><tbody><tr><td style=text-align:center>IntersectionObserver (iframes)</td><td style=text-align:center>❌</td><td style=text-align:center>❌</td><td style=text-align:center>❌</td><td style=text-align:center>❌</td></tr><tr><td style=text-align:center>Lazy Loading</td><td style=text-align:center>✔️</td><td style=text-align:center>✔️</td><td style=text-align:center>❌</td><td style=text-align:center>❌</td></tr></tbody></table><h2 id=references>References
<a class=anchor href=#references>#</a></h2><section class=footnotes role=doc-endnotes><hr><ol><li id=fn:1 role=doc-endnote><p>Privacy concerns with proposal through inducing network requests, <a href=https://github.com/WICG/scroll-to-text-fragment/issues/76>link</a> <a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2 role=doc-endnote><p>Text Fragments - Security and Privacy, <a href=https://wicg.github.io/scroll-to-text-fragment/#security-and-privacy>link</a> <a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:3 role=doc-endnote><p>Scroll-to-text Fragment Navigation - Security Issues, <a href=https://docs.google.com/document/d/1YHcl1-vE_ZnZ0kL2almeikAj2gkwCq8_5xwIae7PVik/edit#>link</a> <a href=#fnref:3 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:4 role=doc-endnote><p>Boldly link where no one has linked before: Text Fragments, <a href=https://web.dev/text-fragments/#privacy>link</a> <a href=#fnref:4 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:5 role=doc-endnote><p>Possible side-channel information leak using IntersectionObserver, <a href=https://github.com/WICG/scroll-to-text-fragment/issues/79>link</a> <a href=#fnref:5 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></section></p></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/xsleaks/wiki/commit/9b963202107fa3bd5834d14f2e61a085192ae77f title="Last modified by David Dworken | October 14, 2020" target=_blank rel=noopener><img src=/svg/calendar.svg class=book-icon alt=Calendar>
<span>Last Modified: October 14, 2020</span></a></div><div><a class="flex align-center" href=https://github.com/xsleaks/wiki/edit/master/content//docs/attacks/experiments/scroll-to-text-fragment.md target=_blank rel=noopener><img src=/svg/edit.svg class=book-icon alt=Edit>
<span>Edit this article</span></a></div></div></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><nav id=TableOfContents><ul><li><a href=#expected--discussed-issues>Expected & Discussed Issues</a></li><li><a href=#current-issues>Current Issues</a></li><li><a href=#why-is-this-a-problem>Why is this a problem?</a><ul><li><a href=#case-scenarios>Case Scenarios</a></li></ul></li><li><a href=#defense>Defense</a></li><li><a href=#references>References</a></li></ul></nav></aside></main></body></html>